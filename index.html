<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>PCP Fábrica dos Parafusos</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    body { font-family: "Sora", sans-serif; padding:30px; background:#f2f4f8; }
    h1 { font-size:32px; font-weight:700; margin-bottom:25px; }
    select,input{padding:6px; font-size:16px; margin-right:10px;}
    button{padding:10px 18px; font-size:16px; border-radius:8px; border:0; cursor:pointer; font-weight:700;}
    #add{background:#1db954; color:white;}
    #reset{background:#e63946; color:white; margin-top:15px;}
    .card{background:white; padding:15px; border-radius:10px; margin-bottom:20px; box-shadow:0 2px 6px rgba(0,0,0,0.08);}    
    .counterBox{font-size:22px;font-weight:600;}
  </style>
</head>
<body>

<h1>PCP Fábrica dos Parafusos</h1>

<div class="card">
  <label>Tipo:</label>
  <select id="tipo">
    <option value="pequeno">parafuso pequeno</option>
    <option value="grande">parafuso grande</option>
  </select>

  <label>Quantidade:</label>
  <input type="number" id="qtd" />

  <button id="add">Adicionar Ordem</button>
  <button id="reset">Reiniciar o Dia</button>
</div>

<div class="card counterBox">
  Pequenos feitos: <span id="cPeq">0</span> | Grandes feitos: <span id="cGra">0</span>
</div>

<div class="card">
  <h2>Fila de ordens</h2>
  <div id="fila"></div>
</div>

<div class="card">
  <h2>Status dos postos</h2>
  <div id="postos"></div>
</div>

<script type="module">
import {db, ref, push, onValue, update, remove} from "./firebase.js";

// adiciona ordem
add.onclick = () => {
  push(ref(db, "orders"), {
    tipo: tipo.value,
    qtd: Number(qtd.value),
    etapa: 0,
    status: "pendente"
  })
}

// ZERAR o dia (apagar ordens)
reset.onclick = ()=>{
  remove(ref(db,"orders"))
  update(ref(db,"prodCount"),{pequeno:0,grande:0})
}

// FILA
onValue(ref(db,"orders"), snap=>{
  fila.innerHTML = ""
  const orders = snap.val()
  if(!orders) return
  Object.entries(orders).forEach(([id,o])=>{
    fila.innerHTML += `<div>#${id} – ${o.tipo} – etapa:${o.etapa} – status:${o.status}</div>`
  })
})

// POSTOS
onValue(ref(db,"posts"), snap=>{
  postos.innerHTML = ""
  const p = snap.val()||{}
  Object.entries(p).forEach(([id,post])=>{
    postos.innerHTML += `<div>Posto ${id} — atual:${post.currentOrder||"-"} — ANDON:${post.andon||"ok"}</div>`
  })
})

// CONTADORES (post4 escreve prodCount no firebase)
onValue(ref(db,"prodCount"), snap=>{
  const c = snap.val()||{pequeno:0,grande:0}
  document.getElementById("cPeq").innerText = c.pequeno
  document.getElementById("cGra").innerText = c.grande
})

</script>
</body>
</html>
